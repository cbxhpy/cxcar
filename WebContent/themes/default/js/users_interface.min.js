(function(){var a=[];a.push(".dispute,.account{top: 100px;_top: expression(eval(document.documentElement.scrollTop+100));}");a.push(".dispute .in{width: 873px;}");a.push(".dispute .note{max-height: 245px;_height:245px;padding:20px 20px 0 20px;margin-bottom:10px;}");a.push(".dispute .note table{border:1px solid #ddd;}");a.push('.dispute .note table td,.dispute .note table th{padding:10px 5px;line-height:16px;border:1px solid #ddd;margin: 0 auto;color:#666;font-family: "宋体";font-size: 12px;}');a.push(".dispute .note table td{text-align: center;}");a.push(".dispute .note a{color:#005ea7;}");a.push(".dispute  .button{text-align: left;border:0;padding:10px 0 10px 20px;}");a.push(".dispute  .button a{padding-left: 21px;margin-right: 8px;background:url("+$.__IMG+'/images/refund.png?0813) 0 -121px no-repeat;height:26px;line-height:26px;display:inline-block;color:#005ea7;font-family: "宋体";font-size: 12px;}');a.push(".dispute .button a span{cursor: pointer;color:#005ea7;display: inline-block;background: url("+$.__IMG+"/images/refund.png?0813) -36px -121px no-repeat;width: 68px;cursor: pointer;}");a.push(".dispute .btns a{background: url("+$.__IMG+'/images/refund.png) 0 0 no-repeat; width: 94px ;height: 30px;margin:0;padding:0;border:0;color: #fff;line-height: 30px;font-size: 14px;font-family: "宋体";}');a.push(".dispute .btns a:hover{background: url("+$.__IMG+"/images/refund.png) 0 0 no-repeat;color: #fff !important;}");a.push(".refund_list .in{width: 371px;border:1px #ddd solid;}");a.push(".refund_list .note table td{line-height: 18px;word-break: break-all;padding:9px 0;}");a.push(".refund_list .note table td.odd{width:92px;}");a.push(".refund_confirm .in .title,.refund_alert .in .title,.refund_list .title{background: #fff;border-bottom:0;}");a.push(".account .in{width:510px;/*height:475px;*/}");a.push(".account .note,.refund_list .note{padding:0 20px 6px 20px;}");a.push(".account .note table{margin:34px 0 5px 0;}");a.push(".account .note table td{line-height: 38px;color:#666;}");a.push('.account .note table td.odd,.refund_list .note table td.odd{padding-right:10px;text-align: right;font-family: "宋体";font-size: 12px;color: #666;}');a.push(".account .note table td.odd{width:188px;}");a.push(".account .note select{border:1px solid #c9c9c9;width: 207px;height:27px;padding:4px 3px;line-height:27px;color: #666;}");a.push('.account .note input{padding-left:8px;height:22px;line-height:22px;border: 1px solid #c9c9c9;width: 197px;font-size: 12px;color: #666;font-family: "宋体";}');a.push(".account .note table td span{color:#e52952;margin-left: 6px;}");a.push(".account .note table td a.capthce:hover,.dispute .button a:hover{text-decoration:none;}");a.push(".account .note table td .capthce{display:inline-block;background: url("+$.__IMG+'/images/refund.png?0813) 0 -151px no-repeat;height:28px;padding-left:12px;line-height:28px;vertical-align: middle;margin-left:7px;font-family: "宋体";}');a.push(".account .note table td .capthce span{cursor: pointer;vertical-align: middle;display:inline-block;background: url("+$.__IMG+"/images/refund.png?0813) -32px -151px no-repeat;width:72px;line-height:28px;height:28px;color:#333;font-size:12px;margin-left:0;}");a.push(".account .note table td .capthce span.second{background-position:-45px -151px;width:59px;}");a.push(".account .note table td .capthce span.first{background-position:-12px -151px;width:92px;color:#999;}");a.push(".account .btns{margin-bottom: 23px;}");a.push(".account .btns a,.refund_confirm .btns a,.refund_list .btns a{background: url("+$.__IMG+'/images/refund.png)  0 -56px no-repeat !important;border:0 !important;padding:0 !important;width:72px;height:26px;color: #666 !important;font-family: "宋体";line-height: 26px;font-size: 12px;}');a.push(".account .btns a:hover,.refund_confirm .btns a:hover,.refund_list .btns a:hover{background: url("+$.__IMG+"/images/refund.png)  0 -56px no-repeat !important;color: #666 !important;}");a.push(".account .btns .lightbox_btnsi_1{margin:0 9px 0 83px;}");a.push(".account .btns .lightbox_btnsi_1,.refund_confirm .btns .lightbox_btnsi_1,.refund_list .btns .lightbox_btnsi_1{background-position: 0  -29px !important;color: #fff !important;text-align: center;}");a.push(".account .btns a.lightbox_btnsi_1:hover,.refund_confirm .btns a.lightbox_btnsi_1:hover,.refund_list .btns a.lightbox_btnsi_1:hover{background-position: 0  -29px !important;color: #fff !important;}");a.push(".refund_confirm,.refund_alert{top:260px;_top:expression(eval(document.documentElement.scrollTop+260));left:-37px;}");a.push(".refund_confirm .in,.refund_alert .in{width: 412px;padding-bottom: 59px;border:1px solid #ddd;}");a.push(".refund_confirm .note,.refund_alert .note{margin-bottom: 14px;}");a.push('.refund_confirm .note td,.refund_alert .note td{font-family: "宋体";font-size: 12px;line-height: 30px;color: #333;}');a.push('.refund_confirm .note td.odd,.refund_alert .note td.odd{font-weight: bold;font-family: "微软雅黑";font-size: 15px;}');a.push(".refund_confirm .note td span{background: url("+$.__IMG+"/images/refund.png)  -33px -82px no-repeat;display: inline-block;width: 34px;height: 39px;margin:0 12px 24px 48px;}");a.push(".refund_alert .in{padding-bottom: 75px;}");a.push(".refund_alert .note{margin-top:16px;}");a.push(".refund_alert .note td span{background: url("+$.__IMG+"/images/refund.png)  0 -82px no-repeat;display: inline-block;width: 34px;height: 39px;margin:0 12px 40px 48px;}");a.push(".refund_alert .note td.td_Width{width: 289px;line-height: 18px;}");$.insertStyle(a.join(""));})();$.fn.tabs=function(){return this.each(function(){var d=$(this);var c=d.find(".title");var a=d.find(".tabItem");var b=d.find(".more");c.each(function(e){$(this).click(function(){$(this).parent().find(".title").removeClass("current");$(this).parent().next(".tabConts").children(".tabItem").hide();$(this).addClass("current");$(this).parent().next(".tabConts").children(".tabItem").eq(e).show();b.addClass("none").eq(e).removeClass("none");});});});};$(function(a){userWin={delWin:function(b){userWin.callFn(b);},callFn:function(b){if(!b){return;}userWin.createMask();userWin.createElement(520,userWin.createContent(b));},createMask:function(){var f=a("#JS_mask"),c=a("#JS_userBox");if(f){f.remove();}if(c){c.remove();}var b=a('<div  id="JS_mask" class="c-mask"></div>'),d=(document.body.scrollHeight>=window.screen.availHeight)?document.body.scrollHeight:window.screen.availHeight;b.css({height:d+"px"});var e=a('<div id="JS_userBox" class="JS_userBox"></div>');a("body").append(b);a("body").append(e);},createElement:function(b,d){var c=a('<div class="c-container"></div>');c.css({width:b+"px"});c.append(a(d));a("#JS_userBox").append(c);},createContent:function(c){var b='<div class="title"><span>取消订单</span><a href="javascript:;" class="closeBtn" onclick="userWin.closeDialog();return false;"></a></div><div class="body delOrder"><form action="/user/?act=cancel_order" method="post" id="order_del_form" name="order_del_form"><p class="f18 red">请你选择取消该订单的原因？以改进我们的服务</p><table class="mt10"><tr><td><label><input type="radio" name="resoncon" value="现在不想购买"/>现在不想购买</label></td><td><label><input type="radio" name="resoncon" value="商品价格比较贵"/>商品价格比较贵</label></td></tr><tr><td><label><input type="radio" name="resoncon" value="有商品缺货"/>有商品缺货</label></td><td><label><input type="radio" name="resoncon" value="支付不成功"/>支付不成功</label></td></tr><tr><td><label><input type="radio" name="resoncon" value="更新或添加新商品"/>更新或添加新商品</label></td><td><label><input type="radio" name="resoncon" value="错误或重复下单"/>错误或重复下单</label></td></tr><tr><td><label><input type="radio" name="resoncon" value="红包或优惠劵使用不成功"/>红包或优惠劵使用不成功</label></td><td><label><input type="radio" name="resoncon" value="1" id="other" />其他</label></td></tr></table><textarea name="other_reason" id="other_reason"></textarea><input type="hidden" value="'+c+'" id="order_id" name="order_id" /><div class="btnBox"><a href="javascript:;" class="btn_b cancel_btn" onclick="userWin.submitForm();return false;"><span>取消订单</span></a> <a href="javascript:;" class="btn_cancel" onclick="userWin.closeDialog();return false;"><span>关闭窗口</span></a></div></form></div>';return b;},createLoading:function(){var b='<div class="tLoading">加载中...</div>';return b;},closeDialog:function(){var c=a("#JS_mask"),b=a("#JS_userBox");c.remove();b.remove();if(typeof callBack=="function"){callBack();}},submitForm:function(){var c=a("#JS_userBox form#order_del_form"),e=a('input[name="resoncon"]').filter(":checked");if(e.length<1){var d=c.find(".cause");if(d.length>0){return;}c.find(".btnBox").append('<p class="cause" style="color:#e52952;margin-top:14px;text-align:center;"><strong>提示：</strong>请选择取消原因！</p>').css("padding-bottom",0);}else{c.submit();}var b=c.find("label");b.each(function(){a(this).click(function(){var f=a('input[name="resoncon"]').filter(":checked");if(f.length>0){c.find(".cause").remove();c.find(".btnBox").css("padding-bottom","20px");}});});}};addressWin={showBox:function(d){var b=a(d).outerWidth();var c=a(d).outerHeight();a("#overlay").show();a(d).show();a(d).css({"margin-left":-(b/2),"margin-right":-(c/2)});},hideBox:function(b){a("#overlay").hide();a(b).hide();}};a.fn.slidePicLong=function(g,f,d,e,c,b){return this.each(function(){var p=a(this);var i=p.find("ul");var l=p.find(".prev");var j=p.find(".next");var o=i.children("li");var q=o.outerWidth()+c;var n=o.length;if(n<=e){l.hide();j.hide();return 0;}else{l.show();j.show();}if(!p.children(".container")){i.wrap('<div class="container"></div>');}i.css({width:q*n});function m(r){switch(r){case"next":i.animate({"margin-left":-q},d,function(){i.css("margin-left","0");i.find("li:first").appendTo(i);});break;case"prev":i.css({"margin-left":-q});i.find("li:last").prependTo(i);i.animate({marginLeft:0},d);break;}}function k(){g=setInterval(function(){m("next");},f);}l.click(function(){clearInterval(g);m("prev");k();return false;});j.click(function(){clearInterval(g);m("next");k();return false;});i.hover(function(){clearInterval(g);},function(){k();});if(g){k();}});};});function save_agree(a){if(!a){return;}var b=a.getAttribute("data-id");if(b==""||b=="undefind"){return;}$.ajax({url:"/interface.html?act=check_refund_pay_type&order_id="+b,dataType:"json",success:function(c){if(c.error==1){$.ajax({url:"/user/?act=save_agreen_refund_mone&id="+b+"&refund_way="+0,type:"GET",dataType:"json",success:function(e){if(e.error==1){__auto_close("JS_lightBox_55",e.msg,e.error);}else{alert(e.msg);location.reload();}},error:function(){$.alert("网络错误！");}});}else{closeHideMask(55);$.showMask();$("#JS_lightBox_55").html();document.body.appendChild(agree_html_new(c.msg,b));var d=$("#JS_lightBox_55");d.style.marginTop="-"+d.offsetHeight/2+"px";}},error:function(){alert("网络错误！");}});}function save_agree_new(b){if(!b){return;}var d=b.getAttribute("data-id");if(d==""||d=="undefind"){return;}var a=$("#JS_lightBox_55"),c=a.find("input:checked").attr("value");$.ajax({url:"/user/?act=save_agreen_refund_mone&id="+d+"&refund_way="+c,type:"GET",dataType:"json",success:function(e){if(e.error==1){__auto_close("JS_lightBox_55",e.msg,e.error);}else{location.reload();}},error:function(){$.alert("网络错误！");}});}function __auto_close(g,f,e){var d=$("#"+g),a=g.replace("JS_lightBox_",""),c="",b=d.get(0);if(e==1){c='<p><i class="e_icon"></i><span>'+f+"</span></p>";}else{c='<p><i class="r_icon"></i><span>'+f+"</span></p>";}c+='<p class="p2">2秒钟后页面关闭<p/>';d.addClass("JS_auto_userBox");b.style.marginTop="-"+b.offsetHeight/2+"px";d.html(c);setTimeout(function(){closeHideMask(a);},2000);}function closeHideMask(a){$.closeLightBox(a);$.hideMask();}function agree_html(c,d){var a="",b=document.createElement("div");b.className="JS_userBox";b.id="JS_lightBox_55";a+='<div class="title"><span>确认退款请同意退款协议</span><a href="javascript:;" onclick="closeHideMask(55)" title="关闭" class="closeBtn"></a></div><div class="body"><div class="content">';a+="<p>"+c+"</p>";a+='<p class="buttons"><a href="javascript:void(0)" class="btn_s" data-id="'+d+'" onclick="save_agree(this)"><span>同意</span></a>';a+='<a href="javascript:void(0)" class="btn_s" onclick="closeHideMask(55)"><span>取消</span></a></p>';a+="</div></div></div>";a+="</div>";b.innerHTML=a;return b;}function agree_html_new(c,d){var a="",b=document.createElement("div");b.className="JS_userBox";b.id="JS_lightBox_55";a+='<div class="title"><span>确认退款请同意退款协议</span><a href="javascript:;" onclick="closeHideMask(55)" title="关闭" class="closeBtn"></a></div><div class="body"><div class="content">';a+='<div class="select_agree_mode">';a+='<p class="p1"><input type="radio" name="s_mode" value="1" checked="checked"><span>原路退回到支付账号(仅限支付宝、网上银行、POS机)</span></p>';a+='<p class="p2">约7到15个工作日</p>';a+='<p class="p1"><input type="radio" name="s_mode" value="2"><span>退回到指定账号</span></p>';a+='<p class="p2">使用信用卡支付，只能选择原路退回</p>';a+="</div>";a+='<p class="buttons"><a href="javascript:void(0)" class="btn_s" data-id="'+d+'" onclick="save_agree_new(this)"><span>确定</span></a></p>';a+="</div></div></div>";a+="</div>";b.innerHTML=a;return b;}function report_judge_html(c){var a="",b=document.createElement("div");b.className="JS_userBox";b.id="JS_lightBox_56";a+='<div class="title"><span>请填写理由！</span><a href="javascript:;" onclick="closeHideMask(56)" title="关闭" class="closeBtn"></a></div><div class="body"><div class="content">';a+='<p><textarea id="JS_judge_reason" rows="4" onclick="this.value=\'\'">请填写您的理由!</textarea></p>';a+='<p class="buttons"><a href="javascript:void(0)" class="btn_s" data-id="'+c+'" onclick="save_judge(this)"><span>确定</span></a>';a+='<a href="javascript:void(0)" onclick="closeHideMask(56)"><span>取消</span></a></p>';a+="</div></div></div>";a+="</div>";b.innerHTML=a;return b;}function save_judge(a){if(!a){return;}var c=a.getAttribute("data-id"),b=$("#JS_judge_reason")[0].value;if(c==""||c=="undefind"){return;}if(b==""||b=="请填写您的理由!"){alert("请先填写您申报纠纷的原因！");return false;}$.ajax({url:"/user/?act=report_judge&id="+c+"&judge_reason="+b,dataType:"json",success:function(d){location.reload();},error:function(){alert("网络错误！");}});}function report_judge(b){if(b==""||b=="undefind"){return;}$.showMask();document.body.appendChild(report_judge_html(b));var a=$("#JS_lightBox_56")[0];a.style.marginTop="-"+a.offsetHeight/2+"px";}function refund_goods_html(c){var a="",b=document.createElement("div");b.className="JS_userBox";b.id="JS_lightBox_56";a+='<div class="title"><span>请填写理由！</span><a href="javascript:;" onclick="closeHideMask(56)" title="关闭" class="closeBtn"></a></div><div class="body"><div class="content">';a+='<p><textarea id="JS_judge_reason" rows="4" onclick="this.value=\'\'">请填写您的理由!</textarea></p>';a+='<p class="buttons"><a href="javascript:void(0)" class="btn_s" data-id="'+c+'" onclick="save_refund(this)"><span>确定</span></a>';a+='<a href="javascript:void(0)" onclick="closeHideMask(56)"><span>取消</span></a></p>';a+="</div></div></div>";a+="</div>";b.innerHTML=a;return b;}function save_refund(a){if(!a){return;}var c=a.getAttribute("data-id"),b=$("#JS_judge_reason")[0].value;if(c==""||c=="undefind"){return;}if(b==""||b=="请填写您的理由!"){alert("请先填写您退换货的原因！");return false;}$.ajax({url:"/user/?act=apply_refund_goods&order_id="+c+"&reason="+b,dataType:"json",success:function(d){alert(d.msg);location.reload();},error:function(){alert("网络错误！");}});}function refund_goods(b){if(b==""||b=="undefind"){return;}$.showMask();document.body.appendChild(refund_goods_html(b));var a=$("#JS_lightBox_56")[0];a.style.marginTop="-"+a.offsetHeight/2+"px";}function confirm_received(b){if(!b){return;}var a=confirm("你确认已经收到货物了吗？");if(a==false){return;}$.ajax({url:"/user/?act=affirm_received&order_id="+b,dataType:"json",success:function(c){alert(c.msg);location.reload();},error:function(){alert("网络错误！");}});}var orderMagage={orderRefund:function(i,c,b,e,a,f){if(i==""||i=="undefined"){return;}var g=$(f).closest(".oper"),d=g.attr("data-time1")||"";$.ajax({url:"/user/",type:"post",data:{act:"balance_show",order_id:i,____:new Date().getTime()},dataType:"json",success:function(l){if(l.error==0||l.error==1){var k=/^\d*\.\d{2}$/;var j="";j+="<div>订单金额：<span style=\"font-family:'微软雅黑'\">&yen;</span>";j+=k.test(l.s_pay)?l.s_pay:l.s_pay+".00";j+="</div><div>已付金额：<span style=\"font-family:'微软雅黑'\">&yen;</span>";j+=k.test(l.a_pay)?l.a_pay:l.a_pay+".00";j+='</div><div>退款金额：<span style="font-family:\'微软雅黑\'">&yen;</span><span style="color:red">';j+=k.test(l.refund)?l.refund:l.refund+".00";j+="</span></div>";if(l.error==1){if(l.finish==1){j+="<div style=\"position:relative; margin:5px 0 0 0; text-align:left; width: 330px; font-family:'微软雅黑'; font-size:16px\">余款退款成功！</div>";}else{j+="<div style=\"position:relative; margin:5px 0 0 0; text-align:left; width: 330px; font-family:'微软雅黑'; font-size:16px\">余款退还中</div>";}$.alert(j);}else{j+="<div style=\"position:relative; margin:5px 0 0 0; text-align:left; width: 330px; font-family:'微软雅黑'; font-size:16px\">确定退还订单余额？</div>";$.confirm(j,{onOk:function(){orderMagage.ajaxPostRefund(i,c,b,e,a,d);}});}}else{if(l.msg){alert(l.msg);}else{alert("网络错误！请稍后刷新页面重试!");}}},error:function(){alert("网络错误！请稍后刷新页面重试!");}});},ajaxPostRefund:function(f,c,b,e,a,d){if(!f){return;}$.ajax({url:"/user/",type:"post",data:{act:"balance_show",order_id:f,submit:1,____:new Date().getTime()},dataType:"json",success:function(g){if(g.error==0){dispute(f,c,b,e,a,g.new_id,d);}else{if(g.msg){alert(g.msg);}else{alert("网络错误！请稍后刷新页面重试!");}}},error:function(){alert("网络错误！请稍后刷新页面重试!");}});}};function agree_refund(b,a,g,f,j,i,d){if(b==""||b=="undefind"){return false;}if(window._agree){return false;}var c=$(d).closest(".oper"),e=c.attr("data-time1")||"";$("#order_search #composite_status").addClass("none");window._agree=true;$.ajax({url:"/user/?act=get_agreen_refund_mone&id="+b,dataType:"json",cache:false,success:function(l){if(l.error==0){var m="客户确认退款协议",k="<p>"+l.msg+"</p>";$.confirm(k,{title:m,onOk:function(){if(window._interface){return false;}window._interface=true;$.ajax({url:"/user/?act=save_agreen_refund_mone&id="+b+"&refund_way="+0,type:"GET",dataType:"json",cache:false,success:function(o){if(o.error==1){$.closeLightBox(false,function(){$("#order_search #composite_status").addClass("none");$.alert(o.msg,{title:"客户确认退款协议",onOk:function(){closeMask();location.reload();}});});}else{if(g==0){var n=o.msg.split("@@")[1];dispute(b,a,f,j,i,n,e);}else{$.alert(o.msg,{title:"客户确认退款协议",onOk:function(){closeMask();location.reload();}});}}window._interface=false;},error:function(){closeMask();window._interface=false;alert("网络错误！");}});},onCancel:function(){closeMask();}});}else{$.alert(l.msg,{onOk:closeMask()});}window._agree=false;},error:function(){closeMask();window._agree=false;alert("网络错误！");}});}function closeMask(){$("#order_search #composite_status").removeClass("none");}function dispute(b,a,j,l,k,d,m,f){if(window._dispute){return false;}var c=$(f).closest(".oper"),i=m||c.attr("data-time1");var g='<div class="clearfix title"><div class="Left"><i style="display:inline-block;"></i><span>确认退款账户</span></div><a href="javascript:;" class="Right" onclick="dispute_close();">×</a></div><div class="body"><div class="note"><table><tr><th width="22">&nbsp;</th><th width="60">支付方式</th><th width="126">收款人账号</th><th width="113">收款银行账户类型</th><th width="56">开卡姓名</th><th width="139">开卡银行详细名称</th><th width="58">开户行所在的省</th><th width="60">开户行所在的市</th><th width="60">认证状态</th><th width="58">操作</th></tr>';window._dispute=true;var e={user_id:$.cookie("user_id"),flag:"1"};if(k==1){e.order_id=b;}$.ajax({url:"/mll_api/api/refund_account",data:e,dataType:"json",async:false,cache:false,success:function(p){var o=0;for(var n in p){o++;g+='<tr id="JS_bank_'+(p[n].id||"")+'" ><td><input type="radio" class="JS_bankId" name="bankId" value="'+(p[n].id||"")+'" '+(p[n].pitch_on==1?"checked":"")+'></td><td data-type="'+(p[n].pay_type||"")+'">'+(p[n].pay_type_c||"")+'</td><td data-type="'+(p[n].card_no||"")+'">'+(p[n].card_no_format||"")+'</td><td data-type="'+(p[n].bank_type||"")+'">'+(p[n].bank_name||"")+'</td><td data-type="'+(p[n].user_id||"")+'">'+(p[n].card_name||"")+"</td><td>"+(p[n].card_address||"")+'</td><td data-type="'+(p[n].province||"")+'">'+(p[n].province_name||"")+'</td><td data-type="'+(p[n].city||"")+'">'+(p[n].city_name||"")+'</td><td data-type="'+(p[n].is_verify||0)+'">'+(p[n].is_verify_c||"待认证")+'</td><td><a href="javascript:;" onclick="account('+b+",'"+a+"',"+(d||null)+","+j+","+l+","+p[n].id+","+i+',this)">修改账户</a></td></tr>';}g+='</table></div><div class="button">';window._dispute=false;},error:function(){window._dispute=false;}});g+='<a href="javascript:;"  onclick="account('+b+",'"+a+"',"+(d||null)+","+j+","+l+",'',"+i+')"><span>使用新账户</span></a></div></div>';$("#order_search #composite_status").addClass("none");$.lightBox(g,{"确认使用":function(){var o=$(".dispute input:checked").val(),n=$("#JS_bank_"+o).find("td").eq(4).html();if(!o){$.alert("请选择所要使用的银行卡信息！");return false;}if(n==a){refund_confirm(b,o,l,d);}else{refund_alert();}}},null,null,null,false,"MALERT MCONFIRM dispute");if($(".dispute tr").length>6){$(".dispute .in").css({width:"902px"});$(".dispute .in .body .note").css({overflow:"auto","_overflow-x":"auto"});}}function dispute_close(){closeMask();$(".dispute").remove();if($(".account")){account_close();}location.reload();return false;}function refund_confirm(e,b,d,a){$(".dispute").remove();if($(".account")){$(".account").remove();}var c='<div class="clearfix title"><div class="Left">&nbsp;</div><a href="javascript:;" class="Right" onclick="refundConfirm_close()">×</a></div><div class="body"><div class="note"><table><tr><td rowspan="2"><span></span></td><td class="odd">温馨提醒：确认退款账户是否正确 </td></tr><tr><td>因退款账户错误导致的退款错误，请自行承担后果！ </td></tr></table></div></div>';$.lightBox(c,{"确认":function(){refund_ok(d,b,e,a);},"取消":function(){refundConfirm_close();}},null,null,null,false,"MALERT MCONFIRM refund_confirm");}function refundConfirm_close(){closeMask();$(".refund_confirm").remove();location.reload();return false;}function refund_ok(d,c,b,a){if(window._ok){return false;}var e={order_id:b,id:c};if(d>1){e.rec_id=a;}window._ok=true;$.ajax({url:"/solr_api/jmll/thirdRefund/updateOrderRefundItem.do",data:e,type:"post",dataType:"json",cache:false,success:function(f){if(f.error==0){refundConfirm_close();location.reload();}else{if(f.error==3){refund_alert();}else{$.alert(f.msg,{onOk:function(){if($(".refund_confirm")){$(".refund_confirm").remove();}}});}}window._ok=false;},error:function(){window._ok=false;}});}function refund_alert(){$(".dispute").remove();if($(".account")){$(".account").remove();}var a='<div class="clearfix title"><div class="Left"><i style="display:inline-block;"></i><span>修改退款账户</span></div><a href="javascript:;" class="Right" onclick="alert_close()">×</a></div><div class="body"><div class="note"><table><tr><td rowspan="2"><span></span></td><td class="odd">亲，您的退款开户名与订单收货人不一致 </td></tr><tr><td class="td_Width">为确保款项准确无误的退款，请联系销售为您处理！由此给您带来不便，还请谅解！</td></tr></table></div></div>';$.lightBox(a,{},null,null,null,false,"MALERT MCONFIRM refund_alert");}function alert_close(){closeMask();$(".refund_alert").remove();location.reload();return false;}function account(m,u,s,d,f,k,e,g){if(window._account){return false;}var p="",n="",o="",j="",a="",l="",r="";h="";if(g){var i=$(g).closest("td").siblings("td"),p=i.eq(1).attr("data-type"),n=i.eq(2).attr("data-type"),o=i.eq(3).attr("data-type"),j=i.eq(4).html(),b=i.eq(5).html(),a=i.eq(6).attr("data-type"),l=i.eq(7).attr("data-type"),r=i.eq(8).html();}h+='<div class="clearfix title"><div class="Left"><i style="display:inline-block;"></i><span>'+(g?"修改":"")+'退款账户</span></div><a href="javascript:;" class="Right" onclick="account_close()">×</a></div><div class="body"><div class="note"><table><tr><td class="odd">支付方式：</td><td><select style="width:207px;" id="JS_pay_type"><option value="0" '+(p==0?"selected":"")+">银行转账</option>"+(f>1?"":'<option value="1" '+(p==1?"selected":"")+">支付宝</option>")+'</select></td></tr><tr><td class="odd">收款人账号：</td><td><input type="text" id="JS_card_no" value="'+(n||"")+'"/></td></tr><tr class="'+(p==1?"none":"")+'"><td class="odd">收款银行账户类型：</td><td><select id="JS_bank_type"><option value="">请选择</option>';var c=window._list;for(var q in c){if(o==c[q].bank_id){h+='<option value="'+(c[q].bank_id||"")+'" selected>'+(c[q].bank_name||"")+"</option>";}else{h+='<option value="'+(c[q].bank_id||"")+'">'+(c[q].bank_name||"")+"</option>";}}h+='</select></td></tr><tr><td class="odd">开卡姓名：</td><td><input type="text" id="JS_userName" value="'+(j||"")+'"/></td></tr><tr class="'+(p==1?"none":"")+'"><td class="odd">开户银行详细名称：</td><td><input type="text" value="'+(b||"")+'" id="JS_card_address"/></td></tr>';window._account=true;$.ajax({url:"/mll_api/api/all_region?level=1,2",dataType:"json",async:false,success:function(x){h+='<tr  class="'+(p==1?"none":"")+'"><td class="odd">开户银行所在城市：</td><td><select id="JS_province" style="width:98px;margin-right:13px;"><option vlaue="">请选择</option>';for(var w in x){if(a==w){h+='<option value="'+(w||"")+'" selected>'+(x[w].name||"")+"</option>";}else{h+='<option value="'+(w||"")+'">'+(x[w].name||"")+"</option>";}}h+='</select><select id="JS_city_" class="'+(g?"none":"")+'"  style="width:98px;"><option value="">请选择</option></select>';for(var w in x){h+='<select class="'+(a!=w?"none":"")+'" id="JS_city_'+w+'"  style="width:98px;"><option value="">请选择</option>';for(var v in x[w].lists){if(l==v){h+='<option value="'+(v||"")+'" selected>'+(x[w].lists[v].name||"")+"</option>";}else{h+='<option value="'+(v||"")+'">'+(x[w].lists[v].name||"")+"</option>";}}h+="</select>";}h+="</td></tr>";window._account=false;},error:function(){window._account=false;}});h+='<tr><td class="odd">认证状态：</td><td>'+(r||"待认证")+'</td></tr><tr><td class="odd">图片验证码：</td><td><input type="text" id="JS_img_capthce" value="" style="width:73px;vertical-align: middle;"/><img src="http://image.meilele.com/images/blank.gif"  onclick="$.getCaptcha(this);" id="JS_sms_captcha_img" height="26" width="56" style="margin-left:20px;cursor: pointer;vertical-align:middle;"/><span id="JS_error" style="display:inline-block;width:20px;height:20px;vertical-align:middle;"></span></td></tr><tr><td class="odd">手机校验码：</td><td><input type="text" id="JS_capthce" value="" style="width:73px;vertical-align: middle;"/><a href="javascript:;" class="capthce" id="JS_check_code" onclick="getCaptha('+d+","+e+')"><span>获取验证码</span></a></td></tr></table></div></div>';$.lightBox(h,{"确认":function(){if(window._next){return false;}var v=$("#JS_pay_type").val(),y=$("#JS_card_no").val(),E=(v==1?"":$("#JS_bank_type").val()),D=$("#JS_userName").val(),w=(v==1?"":$("#JS_card_address").val()),z=(v==1?"":$("#JS_province").val()),B=(v==1?"":$("#JS_city_"+z).val()),A=$("#JS_capthce").val();$(".account #JS_pay_type").addClass("none");$(".account #JS_bank_type").addClass("none");$(".account #JS_province").addClass("none");($("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).addClass("none"):$(".account #JS_city_").addClass("none"));if(v!=1&&!E){$.alert("请选择银行类型！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}if(v!=1&&(!z||!B)){$.alert("请选择省,市！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}if(!D){$.alert("请填写开户名！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}if(!y||(v!=1&&(!/^\d*$/.test(y.replace(/\s/g,""))||y.replace(/\s/g,"").length<16||y.replace(/\s/g,"").length>=20))){$.alert("请输入正确的银行账户！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}if(v!=1&&!w){$.alert("请填写开户支行！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}if(!A){$.alert("请填写手机校验码！",{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});return false;}var x=(k?"/solr_api/jmll/thirdRefund/modifyBackCard.do":"/solr_api/jmll/thirdRefund/addBackCard.do"),C={card_name:D,card_no:y,bank_type:E,card_address:w,province:z,city:B,rec_id:s,pay_type:v,mobile:d,checkCode:A,checkType:"refundList"};if(k){C.id=k;}if(D==u){window._next=true;$.ajax({url:x,data:C,dataType:"json",type:"post",cache:false,success:function(G){if(G.error==0){$(".account").remove();$(".dispute").remove();var F;if(k){F=k;}else{F=G.bankId;}refund_confirm(m,F,f,s);}else{$.alert(G.msg,{onOk:function(){$(".account #JS_pay_type").removeClass("none");$(".account #JS_bank_type").removeClass("none");$(".account #JS_province").removeClass("none");(!$("#JS_city_").hasClass("none")?$(".account #JS_city_"+z).removeClass("none"):$(".account #JS_city_").removeClass("none"));}});}window._next=false;},error:function(){window._next=false;}});}else{refund_alert();}},"取消":function(){account_close();}},null,null,null,false,"MALERT MCONFIRM account");$("#JS_sms_captcha_img").click();$.checkCaptcha($("#JS_img_capthce"));$("#JS_province").change(function(){var y=$(this).val(),x="#JS_city_"+y,w=$(x),v=w.siblings("[id^=JS_city_]");v.addClass("none");w.removeClass("none");});$("#JS_pay_type").change(function(){var x=$(this),w=x.val(),v=x.closest("tr").siblings("tr");if(w==0){v.eq(1).removeClass("none");v.eq(3).removeClass("none");v.eq(4).removeClass("none");}else{v.eq(1).addClass("none");v.eq(3).addClass("none");v.eq(4).addClass("none");}});}function account_close(){$(".account").remove();if(window.getMobileCodeAble){window.getMobileCodeAble=false;}if(window._next){window._next=false;}return false;}function refund_list(a){$.ajax({url:"/mll_api/api/refund_account&user_id="+$.cookie("user_id")+"&order_id="+a+"&flag=2",dataType:"json",cache:false,success:function(c){var b='<div class="clearfix title"><div class="Left">&nbsp;</div><a href="javascript:;" class="Right" onclick="list_close()">×</a></div><div class="body"><div class="note"><table><tr><td class="odd">银行类型：</td><td>'+(c.bank_name||"")+'</td></tr><tr><td class="odd">开户归属地：</td><td>'+(c.province_name||"")+","+(c.city_name||"")+'</td></tr><tr><td class="odd">银行开户名：</td><td>'+(c.card_name||"")+'</td></tr><tr><td class="odd">银行账号：</td><td>'+(c.card_no_format||"")+'</td></tr><tr><td class="odd">开户支行名称：</td><td>'+(c.card_address||"")+"</td></tr></table></div></div>";$("#order_search #composite_status").addClass("none");$.lightBox(b,{},null,null,null,false,"MALERT MCONFIRM refund_list");},error:function(){}});}function list_close(){closeMask();$(".refund_list").remove();}function getCaptha(a,c){if(window.getMobileCodeAble){return false;}var b=$("#JS_img_capthce").val();if(!b){alert("请填写图片验证码！");return false;}window.getMobileCodeAble=true;$.get("/solr_api/captcha/mobileCaptcha/create_send_check_captcha.do?121",{phoneNumber:a,durationTime:2500,captchaType:"refundList",captcha:b},function(d){if(d.error==0){window._code=d.mobileCaptcha;window.countdown(c);(function(e){if(window.goSpread){var f={};var g={send_sms:{phone:e||"13800138000",email:"mllcustomer@meilele.com"}};f.data=g;window.goSpread(["_trackRTEvent",f]);}window.goGdt&&window.goGdt([["add_action","SHOP_VIEW",e||"13800138000","mllcustomer@meilele.com"]]);})();}else{alert(d.msg);window.getMobileCodeAble=false;$("#JS_img_capthce").val("");$("#JS_sms_captcha_img").click();}},"json").fail(function(){window.getMobileCodeAble=false;});}function countdown(c){var d=$("#JS_check_code span"),b=c,a=function(){if(b>0){if(!window.getMobileCodeAble){return false;}$(d).html(b--+"秒后重新获取").removeClass("second").addClass("first");t=setTimeout(a,1000);}else{$(d).html("重新获取").removeClass("first").addClass("second");window.getMobileCodeAble=false;}};$(d).html(""+b--+"秒后重新获取").removeClass("second").addClass("first");a();}
/*yangqian:2015-04-21 10:59:30*/