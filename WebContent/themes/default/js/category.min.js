/*20150505*/var MAIN_DOMAIN="/";function goodAddToCat(d,c,b){d=d||null;if(d==null){return;}var a={};a[d]="1";$.addToCart(d,a,null,{is_logistics:"1"},null,b);}function saleNumUpdate(){if($.saleNumUpdate){$.saleNumUpdate([{selector:".JS_async_price",type:"price",param:"price_id",key:"show_price"},{selector:".JS_async_sale_num",type:"sale_num",param:"id",key:"num"}],function(){});}}function goodCollect(c,b){c=c||null;if(c==null){return;}$.ajax({url:"/ajax_user/?act=collect&id="+c,dataType:"json",cache:false,success:function(d){if(d.error==2){$.cookie("meilele_login","0");$.showLoginBox(function(){goodCollect(c,1);});}else{$.alert(d.message);a(["新版列表页","收藏","成功_"+c]);}},error:function(){$.alert("由于网络原因，收藏失败，请稍后再试。");}});if(!b){a(["新版列表页","收藏","点击_"+c]);}function a(d){window._gaq.push(["_trackEvent"].concat(d));}}function TabMouseover(f,g,d,c){var a=$("#"+f+" .fixture_title");var b=$("."+g);var e=$("#"+f+" a");a.mouseover(function(){var i=a.index(this);for(var h=0;h<a.length;h++){if(a[h].innerHTML.length>3&&d==1){a[h].innerHTML=a[h].innerHTML.slice(2);}a[h].className="fixture_title Left";b[h].className=g+" none";}if(d==1){a[i].innerHTML="推荐"+a[i].innerHTML;}a[i].className="fixture_title Left current";b[i].className=g;if(c){e[0].href=c[i];}});}var SelectRegion={init:function(f){var g=this;var c=getLocalData("stockArea");var d=[];if(c){d=c.split(",");}this.areaIds=d;var g=this;var e=$("#JS_region_select_box");e.on("click","#JS_province_tab",function(){g.activate(this);}).on("click","#JS_city_tab",function(){g.activate(this);var h=$(this);if(g.curSelect.pro<0){var i=h.data("parent_id");if(i){g.curSelect.pro=i;g.select(i,"",0);}}}).on("click","#JS_region_tab",function(){g.activate(this);var h=$(this);if(g.curSelect.city<0){var i=h.data("parent_id");if(i){g.curSelect.city=i;g.select(i,"",1);}}}).on("click","#JS_province_select a.r-item",function(){var h=$(this);var i=h.data("region_id");g.select(i,h.text(),0);}).on("click","#JS_city_select a.r-item",function(){var h=$(this);var i=h.data("region_id");g.select(i,h.text(),1);g.curSelect.city=i;}).on("click","#JS_region_select a.r-item",function(){var h=$(this);var i=h.data("region_id");g.select(i,h.text(),2);g.curSelect.region=i;}).on("click",".a-close",function(){$("#JS_area_select").removeClass("o-select-active");$("#JS_area_select").removeClass("o-select-active");$("#JS_area_select").find(".o-shadow").css({width:"0px",height:"0px",overflow:"hidden"});$("#JS_region_select_box").addClass("none");});this.boxs={};this.boxs.pro={tab:e.find("#JS_province_tab"),select:e.find("#JS_province_select")};this.boxs.city={tab:e.find("#JS_city_tab"),select:e.find("#JS_city_select")};this.boxs.rgn={tab:e.find("#JS_region_tab"),select:e.find("#JS_region_select")};if(f&&f.city>0){var b={2:{name:"北京",id:35},10:{name:"上海",id:110},3:{name:"天津",id:36},23:{name:"重庆",id:271}};var a=this.boxs;a.pro.tab.find(".name").html((f.proName+""||"请选择").substr(0,5));a.city.tab.attr("data-parent_id",f.pro||0).find(".name").html((f.cityName+""||"请选择").substr(0,5));if(f.pro&&f.pro in b){a.city.tab.addClass("none");}else{a.city.tab.removeClass("none");}setTimeout(function(){a.rgn.tab.attr("data-parent_id",f.city||0).addClass("t-cur").find(".name").html((f.regionName+""||"请选择").substr(0,5));a.rgn.tab.removeClass("none")[0].click();},0);}},activate:function(b,d){var c=$(b);var a=c.index();b=this.boxs[this.tabs[a]];b.tab.addClass("t-cur").removeClass("none").siblings(".t-tab").removeClass("t-cur");b.select.removeClass("none").siblings().addClass("none");},tabs:["pro","city","rgn"],select:function(h,e,b,g){if(e&&typeof b!="undefined"){this.boxs[this.tabs[b]].tab.find(".name").html(e.substr(0,5));}if(b==0&&h&&this.curSelect.pro!=h){this.boxs[this.tabs[b]].tab.siblings(".t-tab").addClass("none");this.curSelect.pro=h;}var a={0:{name:"全国",id:0},2:{name:"北京",id:35},10:{name:"上海",id:110},3:{name:"天津",id:36},23:{name:"重庆",id:271}};if(h in a){if(h==0){this.redirect(0);return;}var d=a[h];this.select(d.id,d.name,1);this.curSelect.city=h;this.boxs[this.tabs[1]].tab.addClass("none");this.boxs[this.tabs[1]].select.addClass("none");return;}this.areaIds[b]=h;if(b==2){this.redirect(h);return;}var f=this;if(h in f.cache){c(f.cache[h]);}else{$.ajax({url:f.domain+'ajax_ajax/?act=data_center&module=common&method=getRegionByParentId&param={"parent_id":'+h+"}",dataType:"json",success:c});}function c(i){if(i&&i.error==0&&i.region_list&&i.region_list.length>0){var j=f.boxs[f.tabs[b+1]];e&&j.tab.find(".name").html("请选择");j.select.html(f.format(i,h));f.activate(j.tab);if(!(h in f.cache)){f.cache[h]=i;}}else{var j=f.boxs[f.tabs[b+1]];j.tab.nextAll(".t-tab").addClass("none");f.redirect(h);}typeof g=="function"&&g(i);}},redirect:function(a){saveLocalData(this.areaIds);if(_basic_url&&a){setTimeout(function(){window.location.href=_basic_url.replace(/xxxx/,a);},10);return true;}return false;},format:function(c){var f=c.region_list||[];if(!f&&!f.length){return"";}var g=$.trim;var a=f.length;var d=[];for(var b=0;b<a;b++){var e=f[b];e.region_name=g(e.region_name);d.push("<li "+(e.region_name.length>4?'class="long"':"")+'><a title="'+e.region_name+'" data-region_id="'+e.region_id+'" class="r-item" href="javascript:void(0)">'+e.region_name+"</a></li>");}return d.join("");},regions:[],domain:MAIN_DOMAIN,cache:{},curSelect:{pro:-1,city:-1,region:-1}};function getLocalData(a){var b="";if(a){b=$.cookie(a)||"";}return b;}function saveLocalData(a,b){if($.type(a)=="object"){$.each(a,function(c){saveLocalData(c,a[c]);});}else{if($.type(a)=="array"){saveLocalData("stockArea",a.join(","));}else{if(a&&b){$.cookie(a,b);}}}}function CategoryInit2(){var b=$("#JS_category_filter");if(b.length<=0){return;}var d=b.find("dl");var e=function(){d.each(function(k){var n=d.eq(k);var g=n.attr("is-brand");var m=n.find("table");var j=n.find(".jMore");var l=m.height();if(!g&&l>24){j.css({display:"inline-block"}).addClass("JS_more");}});};e();var a=[];function c(){a=d.find(".JS_more");if(a.length<=0){return;}a.click(function(){var g=g=$(this).parents(".shell");if($(this).attr("is-open")=="true"){g.removeClass("auto");$(this).removeAttr("is-open",false).html("<span>更多</span><i></i>").removeClass("open");}else{g.addClass("auto");$(this).attr("is-open",true).html("<span>收起</span><i></i>").addClass("open");}});}c();function f(){var i=$("#JS_brand_overflow"),j=$("#JS_brand_more"),k=i.attr("data-total"),h=i.attr("data-line"),g=0;if(h>1){j.css({display:"inline-block"});j.click(function(){if(h>4){g=209+"px";i.css({"overflow-y":"auto"});}else{if(h==4){g=209+"px";}else{if(h==3){g=157+"px";}else{if(h==2){g=105+"px";}}}}i.css({height:g});if($(this).attr("data-state")==1){$(this).removeAttr("data-state",0).html("<span>更多</span><i></i>").removeClass("open");i.css({height:"53px",overflow:"hidden"});i.scrollTop(0);}else{$(this).attr("data-state",1).html("<span>收起</span><i></i>").addClass("open");}});}i.find("li").hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});}f();$("#JS_exp_fliter").on("click",function(){var k=$(this);var h=k.find("span");k.toggleClass("open");h.data("txt")||h.data("txt",h.text());h.text(h.text()=="收起"?h.data("txt")||"展开":"收起");var j=$("#JS_category_filter").find("dl"),i=j.filter(function(){return $(this).hasClass("normal")||$(this).hasClass("brand");});i=i.slice(2);if(k.attr("state")=="1"){g(i,0,k);}else{g(i,1,k);}function g(m,l,n){m.each(function(o){l=="1"?m.eq(o).removeClass("none"):m.eq(o).addClass("none");});n.attr("state",l);}});}CategoryInit2();function initPriceFilter(){var a=$("#JS_filter_price_btn"),b=$("#JS_filter_price_max"),c=$("#JS_filter_price_min");if(a.length&&b.length&&c.length){function d(){var e=parseInt(b.val()),h=parseInt(c.val()),f,g=CG.priceUrl||window.location.href;if(e>0&&h>=0&&g){if(e<h){f=h;h=e;e=f;}g=g.replace("-n1",h==0?"":"-n"+h);g=g.replace("-x1","-x"+e);window.location.href=g;}return false;}a.click(d);b.keyup(function(e){if(e.keyCode==13){d();}});c.keyup(function(e){if(e.keyCode==13){d();}});}}function initSort(){var c=$("region_id");var b=0;$("#JS_sort_panel").on("mouseenter",".o-time .o-select",function(){$(this).addClass("o-select-hover");}).on("mouseleave",".o-time .o-select",function(){$(this).removeClass("o-select-hover");}).on("click","#JS_area_select",function(){$(this).toggleClass("o-select-active");$("#JS_region_select_box").toggleClass("none");if(!SelectRegion.init.inited){SelectRegion.init(_curRegionInfo);SelectRegion.init.inited=1;}if($(this).hasClass("o-select-active")){var d=$(this).width();$(this).find(".o-shadow").css({width:d+10+"px",height:"4px",overflow:"hidden"});}else{$(this).find(".o-shadow").css({width:"0px",height:"0px",overflow:"hidden"});}}).on("click","#JS_region_select_box",function(d){a(d);}).on("click","#JS_area_select",function(d){a(d);});$(document).on("click",function(){$("#JS_area_select").removeClass("o-select-active");$("#JS_area_select").find(".o-shadow").css({width:"0px",height:"0px",overflow:"hidden"});$("#JS_region_select_box").addClass("none");});function a(d){d=d||window.event;d.stopPropagation?d.stopPropagation():d.cancleBubble=true;}}function initGoodsList(){$("#JS_list_panel").on("mouseenter",".g-item",function(){$(this).addClass("g-hover");}).on("mouseleave",".g-item",function(){$(this).removeClass("g-hover");});}if(exprCallBackNum&&exprCallBackNum.callFnArr){exprCallBackNum.callFnArr.push(function(a){var b=a.html_content;if(!b){if(!_allExprInfo){return false;}b={city:_allExprInfo.city_name,expr_count:_allExprInfo.expr_num};}$("#JS_expr_info").removeClass("none").find("a").html(b.city+(b.expr_count||0)+"家体验馆");});}function initTrackEvent(){window._gaq=window._gaq||[];$("#JS_category_filter").one("mouseenter.trackEvent","#JS_filter_cat_menu",function(){a(["新版列表页","鼠标移入二级分类",$("#JS_filter_cats").find("a.current").text()]);}).one("click.trackEvent",".price-btn",function(){a(["新版列表页","更多筛选类型按钮",$("#JS_filter_cats").find("a.current").text()]);});$(document).on("click.trackEvent",".t-sale",function(){a(["新版列表页","已售"]);}).on("click.trackEvent",".t-pop",function(){a(["新版列表页","人气"]);}).on("click.trackEvent",".t-score",function(){a(["新版列表页","评分"]);});function a(b){window._gaq.push(["_trackEvent"].concat(b));}}function initImgLoader(f){var e=$(window);var d=e.scrollTop();var f=f||300;if(d>f){a();}else{e.on("load",c).on("scroll",g);}function g(){d=e.scrollTop();if(d>f){a();b();}}function c(){a();b();}function b(){setTimeout(function(){e.off("load",c).off("scroll",g);},0);}function a(){jQuery.lazyImg.start("both",{attributeTag:"data-src",loaderNumber:10});}}(function(c){var b=c("#JS_filter_fixed_cats");var a=230;var d=c(window).scrollTop();if(d>=a){b.show();}c(window).on("scroll",function(){d=c(this).scrollTop();if(d>=a){b.show();}else{b.hide();}});})(jQuery);$(function(){initPriceFilter();saleNumUpdate();initSort();initGoodsList();initTrackEvent();initImgLoader(300);new TabMouseover("JS_fixture_recom","fixture_commune",1,_fixture_url);new TabMouseover("JS_fixture_article","fixture_knowledge",0,_fixture_bbs);});
/*leihao:2015-05-05 11:44:05*/